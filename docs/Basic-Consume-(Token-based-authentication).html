

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic Consume token based-authentication example &mdash; OpenDXL Streaming Java Client Library 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic Consume user and password based-authentication example" href="Basic-Consume-(user-and-pass-authentication).html" />
    <link rel="prev" title="Prerequisites" href="Prerequisites.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> OpenDXL Streaming Java Client Library
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="Prerequisites.html">Prerequisites</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Consume token based-authentication example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sample-code">Sample Code</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Basic-Consume-(user-and-pass-authentication).html">Basic Consume user and password based-authentication example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Basic-Consume-(command-line-interface).html">Consume CLI (Command Line Interface)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenDXL Streaming Java Client Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Basic Consume token based-authentication example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-consume-token-based-authentication-example">
<span id="basic-consume-token-based-authentication-example"></span><h1>Basic Consume token based-authentication example<a class="headerlink" href="#basic-consume-token-based-authentication-example" title="Permalink to this headline">¶</a></h1>
<p>This sample demonstrates how to establish a channel connection to the DXL streaming service by using an identity token authentication mechanism. Once the connection is established, the sample repeatedly consumes and displays available records for the consumer group.</p>
<p>Code highlights are shown below:</p>
<p><em>Note:</em> <code class="docutils literal notranslate"><span class="pre">&lt;0.0.0.0&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;PORT&gt;</span></code> are placeholders which you should respectively replace with the Http Proxy IP address or hostname and TCP port number.</p>
<div class="section" id="sample-code">
<span id="sample-code"></span><h2>Sample Code<a class="headerlink" href="#sample-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a new Channel object</span>
<span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Channel</span><span class="o">(</span><span class="n">channelUrl</span><span class="o">,</span>
                <span class="k">new</span> <span class="n">ChannelAuthToken</span><span class="o">(</span><span class="n">token</span><span class="o">),</span>
                <span class="n">channelConsumerGroup</span><span class="o">,</span>
                <span class="n">pathPrefix</span><span class="o">,</span>
                <span class="n">consumerPathPrefix</span><span class="o">,</span>
                <span class="kc">true</span><span class="o">,</span>
                <span class="n">verifyCertificateBundle</span><span class="o">,</span>
                <span class="n">extraConfigs</span><span class="o">,</span>
                <span class="k">new</span> <span class="n">HttpProxySettings</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span>
                        <span class="o">&lt;</span><span class="mf">0.0.0.0</span><span class="o">&gt;,</span>
                        <span class="o">&lt;</span><span class="n">PORT</span><span class="o">&gt;,</span>
                        <span class="s">&quot;me&quot;</span><span class="o">,</span>
                        <span class="s">&quot;secret&quot;</span><span class="o">))</span>

<span class="c1">// Create object which processCallback() method will be called back upon by the run method (see below)</span>
<span class="c1">// when records are received from the channel</span>
<span class="n">ConsumerRecordProcessor</span> <span class="n">consumerRecordCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsumerRecordProcessor</span><span class="o">()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">processCallback</span><span class="o">(</span><span class="n">ConsumerRecords</span> <span class="n">consumerRecords</span><span class="o">,</span> <span class="n">String</span> <span class="n">consumerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Print the received payloads. &#39;payloads&#39; is a list of</span>
        <span class="c1">// dictionary objects extracted from the records received</span>
        <span class="c1">// from the channel.</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">(</span><span class="s">&quot;Received &quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">consumerRecords</span><span class="o">.</span><span class="na">getRecords</span><span class="o">().</span><span class="na">size</span><span class="o">())</span>
                <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot; records&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">toString</span><span class="o">());</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">ConsumerRecords</span><span class="o">.</span><span class="na">ConsumerRecord</span> <span class="n">record</span> <span class="o">:</span> <span class="n">consumerRecords</span><span class="o">.</span><span class="na">getRecords</span><span class="o">())</span> <span class="o">{</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;topic = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getTopic</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;partition = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getPartition</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;offset = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getOffset</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;sharding key = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getShardingKey</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;headers = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;payload = &quot;</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="na">getPayload</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;decoded payload = &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">getDecodedPayload</span><span class="o">()));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>

        <span class="o">}</span>

        <span class="c1">// Return &#39;True&#39; in order for the &#39;run&#39; call to continue attempting to consume records.</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;let commit records&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="c1">// Consume records indefinitely</span>
<span class="kd">final</span> <span class="kt">int</span> <span class="n">consumePollTimeoutMs</span> <span class="o">=</span> <span class="mi">500</span><span class="o">;</span>
<span class="n">channel</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">consumerRecordCallback</span><span class="o">,</span> <span class="n">channelTopicSubscriptions</span><span class="o">,</span> <span class="n">consumePollTimeoutMs</span><span class="o">);</span>
</pre></div>
</div>
<p>The first step is to create a <code class="docutils literal notranslate"><span class="pre">Channel</span></code> instance, which establishes a channel
to the streaming service. The channel includes the URL to the streaming
service, <code class="docutils literal notranslate"><span class="pre">channelUrl</span></code>, and TOKEN that the client uses to authenticate
itself to the service, <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">ChannelAuthToken(token)</span></code>. It also includes a certificate, <code class="docutils literal notranslate"><span class="pre">verifyCertificateBundle</span></code> , and HTTP proxy settings <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">HttpProxySettings(...)</span></code></p>
<p>The example defines a <code class="docutils literal notranslate"><span class="pre">consumerRecordCallback</span></code> instance which is invoked with the
<code class="docutils literal notranslate"><span class="pre">consumerRecords</span></code> extracted from records consumed from the
channel. The <code class="docutils literal notranslate"><span class="pre">consumerRecordCallback</span></code> function outputs the contents of the
each record, its metadata  and returns <code class="docutils literal notranslate"><span class="pre">true</span></code> to indicate that the channel should
continue consuming records. Note that if the <code class="docutils literal notranslate"><span class="pre">consumerRecordCallback</span></code> function were
to instead return <code class="docutils literal notranslate"><span class="pre">false</span></code>, the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method would stop polling the service
for new records and it would return.</p>
<p>The final step is to call the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method. The <code class="docutils literal notranslate"><span class="pre">run()</span></code> method establishes a
consumer instance with the service, subscribes the consumer instance for records
delivered to the <code class="docutils literal notranslate"><span class="pre">topics</span></code> included in the <code class="docutils literal notranslate"><span class="pre">channelTopicSubscriptions</span></code>
variable, and continuously polls the streaming service for available records. The
records from any records which are received from the streaming service are
passed in a call to the <code class="docutils literal notranslate"><span class="pre">consumerRecordCallback</span></code> instance. Note that if no records
are received from a poll attempt, an empty list of records is passed into the
<code class="docutils literal notranslate"><span class="pre">consumerRecordCallback</span></code> function.</p>
<p>As records are received by the sample, the contents of the messages
should be displayed to the output window. The output should appear similar to
the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic1</span><span class="o">-</span><span class="mi">5</span><span class="n">ca969eb</span><span class="o">-</span><span class="mi">2757</span><span class="o">-</span><span class="mi">46</span><span class="n">ed</span><span class="o">-</span><span class="n">bc3f</span><span class="o">-</span><span class="n">f9266ccccea7</span>
<span class="n">partition</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">sharding</span> <span class="n">key</span> <span class="o">=</span> <span class="n">pool</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">thread</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">sourceId</span><span class="o">=</span><span class="n">abc</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">algo</span><span class="p">,</span> <span class="n">tenantId</span><span class="o">=</span><span class="mi">5</span><span class="n">ca969eb</span><span class="o">-</span><span class="mi">2757</span><span class="o">-</span><span class="mi">46</span><span class="n">ed</span><span class="o">-</span><span class="n">bc3f</span><span class="o">-</span><span class="n">f9266ccccea7</span><span class="p">,</span> <span class="n">zoneId</span><span class="o">=</span><span class="n">TMP</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">TRUCHATOR</span><span class="p">}</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">SGVsbG8gV29ybGQgYXQ6MjAxOS0wNS0wN1QxNjowMjoxOC42NjcgRXh0cmE6IEI0ODlNOTNTSFVEME5VTVYzWlZKTU43NkJSNE5HUEE4NFIzSVI1R1NDME05WTFYT1FISjMyNzhMSzY2UFpYNTg4QU42WjEyMjlKRUE4Nlg2MDhLSUxDSDczSFRSSkQyUlNKTkQ</span><span class="o">=</span>
<span class="n">decoded</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">Hello</span> <span class="n">World</span> <span class="n">at</span><span class="p">:</span><span class="mi">2019</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">07</span><span class="n">T16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">18.667</span> <span class="n">Extra</span><span class="p">:</span> <span class="n">B489M93SHUD0NUMV3ZVJMN76BR4NGPA84R3IR5GSC0M9Y1XOQHJ3278LK66PZX588AN6Z1229JEA86X608KILCH73HTRJD2RSJND</span>

<span class="n">topic</span> <span class="o">=</span> <span class="n">topic1</span><span class="o">-</span><span class="mi">5</span><span class="n">ca969eb</span><span class="o">-</span><span class="mi">2757</span><span class="o">-</span><span class="mi">46</span><span class="n">ed</span><span class="o">-</span><span class="n">bc3f</span><span class="o">-</span><span class="n">f9266ccccea7</span>
<span class="n">partition</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">sharding</span> <span class="n">key</span> <span class="o">=</span> <span class="n">pool</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">thread</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">sourceId</span><span class="o">=</span><span class="n">abc</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">algo</span><span class="p">,</span> <span class="n">tenantId</span><span class="o">=</span><span class="mi">5</span><span class="n">ca969eb</span><span class="o">-</span><span class="mi">2757</span><span class="o">-</span><span class="mi">46</span><span class="n">ed</span><span class="o">-</span><span class="n">bc3f</span><span class="o">-</span><span class="n">f9266ccccea7</span><span class="p">,</span> <span class="n">zoneId</span><span class="o">=</span><span class="n">TMP</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">TRUCHATOR</span><span class="p">}</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">SGVsbG8gV29ybGQgYXQ6MjAxOS0wNS0wN1QxNjowMjoyMi4wNzggRXh0cmE6IDk5MVYwN0FOOUdOOUROTjVYRUo2Q09NTzQwU1ZRVFJTRlZYUUZBWVE1WjRFV1paME5XVkVRNElaVk5aTzlORkxRMTlKVEw2Q1lGNVJWV0RJRUpPQkM3OTM5TzBTTkQ5OFpKTVg</span><span class="o">=</span>
<span class="n">decoded</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">Hello</span> <span class="n">World</span> <span class="n">at</span><span class="p">:</span><span class="mi">2019</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">07</span><span class="n">T16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">22.078</span> <span class="n">Extra</span><span class="p">:</span> <span class="mi">991</span><span class="n">V07AN9GN9DNN5XEJ6COMO40SVQTRSFVXQFAYQ5Z4EWZZ0NWVEQ4IZVNZO9NFLQ19JTL6CYF5RVWDIEJOBC7939O0SND98ZJMX</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Basic-Consume-(user-and-pass-authentication).html" class="btn btn-neutral float-right" title="Basic Consume user and password based-authentication example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Prerequisites.html" class="btn btn-neutral" title="Prerequisites" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, McAfee LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>